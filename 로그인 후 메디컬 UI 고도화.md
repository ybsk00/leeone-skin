# [AntiGravity 작업지시서] 로그인 후 메디컬 UI 고도화 (밋밋함 해소 + 기능 체감 강화)

## 0) 목표
현재 로그인 후 메디컬 화면(배너 + 예진 상담 채팅)이 밋밋하므로,
사용자가 “지금 할 수 있는 액션”과 “내 상태/기록”을 한눈에 볼 수 있게 개선한다.

- 기존 EMR 연동 없이 구현 (업로드/요약/상담기록 중심)
- 의료법 리스크 최소화: 진단/확정/처방을 하지 않고 “정리/권고/의사 상담 유도” 중심
- 구현 위치: `https://www.widamcare.co.kr/healthcare/chat?topic=digestion` 등 로그인 후 메디컬 영역 공통 적용

---

## 1) 최종 산출물(Deliverables)
1. 로그인 후 메디컬 화면 레이아웃 개편(좌측 패널 + 우측 채팅)
2. 상단/좌측 “퀵 액션 4버튼” + 각 기능 모달
3. “문진 템플릿(카드형)” 플로우 + 자동 요약 생성
4. “상담 기록/요약 타임라인” (최근 상담 리스트, 요약 보기)
5. “내 상태 요약(최근 7일)” 위젯 (예약/요약/업로드)
6. “업로드(문서/이미지)” 기능 + 파일 목록
7. “복약 도우미” 모드(처방전/약봉지 업로드 기반 안내) *가능하면 1차 포함*
8. 안전 가드 UI(고정 안내 배지 + 레드플래그 경고 카드)

---

## 2) 화면 UI/레이아웃(필수)
### 2.1 레이아웃 변경
- 기존: 배너 + 채팅 단일 컬럼
- 변경: 2컬럼
  - **Left Panel (320~360px)**: 정보/액션/요약/기록
  - **Right Main**: 채팅(예진 상담)

### 2.2 Left Panel 구성(위→아래)
1) **다음 예약 카드**
   - 예약 없음이면: “예약하기” CTA 버튼
   - 예약 있음이면: 일정/의료진/관리 버튼
2) **퀵 액션 4버튼** (그리드 2x2)
   - 예약하기/예약변경
   - 증상정리 시작(문진)
   - 복약 도우미
   - 검사/문서 업로드
3) **내 상태 요약(최근 7일)**
   - 최근 상담 요약 1~2개
   - 최근 업로드 1~2개
4) **상담 기록 타임라인(최근 5개)**
   - 날짜 + 제목 + “보기” 버튼

### 2.3 Right Main(채팅 상단)
- 상담 모드 탭:
  - `문진` / `일반상담` / `복약` / `기록요약`
- 탭 변경 시 입력 힌트(placeholder)와 프롬프트/시스템 모드가 달라짐

---

## 3) 기능 상세 요구사항

## 3.1 퀵 액션 4버튼(필수)
- 버튼 클릭 시 모달 오픈
- 모달에서 완료 시:
  - 이벤트 로그(추적용) 기록 가능하면 기록
  - 완료 메시지 + 타임라인/요약 위젯 갱신

### 3.1.1 예약하기/예약관리
- 기존 예약 흐름 모달을 그대로 연결(있으면 재사용)

### 3.1.2 증상 정리 시작(문진 템플릿)
- 카드형 질문 플로우
- 입력 항목(필수):
  - 증상 범주(소화/통증·재활/면역/여성/인지·수면/기타)
  - 시작 시점(언제부터)
  - 강도(0~10)
  - 악화/완화 요인
  - 동반 증상 체크
  - 레드플래그 체크(가슴통증/호흡곤란/마비/의식저하/심한 출혈/고열 지속 등)
- 완료 시 결과 출력:
  - “진단” 금지
  - “의사 상담 시 도움이 되는 정리 요약” + “추가 질문 3개” 형태
- 결과는 상담 기록에 저장(요약)

### 3.1.3 검사/문서 업로드
- 파일: 이미지(JPG/PNG) + PDF
- 업로드 후 목록 표시(최근 5개)
- 1차 MVP: 파일 업로드 + 메타데이터 저장까지
- 2차: 요약 추출(텍스트/핵심 항목) 기능

### 3.1.4 복약 도우미
- 약봉지/처방전 이미지 업로드 → 복용 가이드 생성
- 출력 형식(필수):
  - 복용 시간/방법(일반적 안내)
  - 주의사항
  - “의사/약사 상담 권유” 고정
- 진단/처방/약 변경 지시 금지

---

## 3.2 상담 기록/요약 타임라인(필수)
- 최근 상담 세션 목록 표시
- 각 세션:
  - 생성일
  - 자동 제목(예: “소화 불편 상담”, “복약 안내”)
  - 요약 보기(모달)
- 저장 방식:
  - 세션 단위로 “요약” 저장(전체 대화 원문 저장은 기존 방식 유지/정책에 맞게)

---

## 3.3 내 상태 요약 위젯(필수)
- 최근 7일 기준
  - 최근 상담 요약 1~2개
  - 최근 업로드 1~2개
  - 다음 예약 요약
- CTA: “요약 더보기”, “업로드”, “예약”

---

## 3.4 안전 가드 UI(필수)
- 채팅 상단 고정 배지:
  - “본 서비스는 진단/처방이 아닌 생활/문진 정리 도움” 문구
  - 응급 시 119/응급실 안내
- 레드플래그 체크에서 “예”인 경우:
  - 즉시 경고 카드 노출 + “즉시 의료기관/응급 안내” + “예약 안내(비응급 시)” 버튼
- 경고 문구는 과도한 단정/확정 없이 안전하게

---


## 5) 구현 우선순위(권장 일정)
### Phase 1 (필수 MVP, 먼저 완료)
1) 레이아웃 2컬럼 + Left Panel 구성
2) 퀵액션 4버튼 + 모달 UI(예약/문진/업로드/복약)
3) 문진 템플릿 완료 → 요약 생성 → 기록 저장
4) 상담 기록/요약 타임라인
5) 안전 가드(고정 배지 + 레드플래그 카드)

### Phase 2 (고도화)
6) 업로드 문서 요약 추출
7) 복약 도우미 고도화(알림/복용 스케줄은 선택)
8) “의사에게 보여주기(PDF 요약 출력)” 기능

---

## 6) QA 체크리스트
- 로그인 후 메디컬 화면에서 밋밋함이 해소되었는가(액션/정보/기록이 보이는가)
- 문진 템플릿 완료 시 “진단/확정” 문구 없이 요약 + 추가 질문만 제공되는가
- 레드플래그 체크 시 즉시 경고/응급 안내가 노출되는가
- 상담 요약이 타임라인에 저장/조회되는가
- 업로드가 저장되고 목록에 노출되는가
- 빌드 시 Supabase ENV 누락으로 터지지 않도록 서버/클라이언트 생성 패턴 점검

---

## 7) 개발 메모(중요)
- Supabase client는 “모듈 최상단 생성” 금지(빌드 타임 크래시 방지)
- `NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY` 환경변수는 로컬/배포 모두 설정 필요
- 의료법 리스크 방지: “가능성/추정/진단/처방” 표현 금지, “정리/참고/상담 권유” 중심

---
끝.
